## General purpose CMA-ES code

This repository provides an interface for using the CMA-ES algorithm to optimize a blackbox function given by a user provided executable. CMA-ES is an optimization method that optimizes outputs with respect to input parameters. CMA-ES works by generating a set of possible parameter set values, evaluating each set of values, and then using the best performing parameter sets to update the generation process for the next iteration. For more details see [wikipedia](https://en.wikipedia.org/wiki/CMA-ES) or [this tutorial](https://arxiv.org/abs/1604.00772).

# Install Instructions

Compile all the .java files under cma/java: `cd cma/java; javac *.java`

# Pre-optimization steps

## Creating the executable to optimize

This code optimizes a output float value from a given executable with respect to input parameters. It assumes that your executable can be run as:

```exectuable <value_file_name> [additional positional arguments] --params_file <params_file_name> [additional keyword arguments]```

The file `<value_file_name>` is where the executable output will be written. This output should be a single float value. The parameter file will be in the format:

```
<param1_name>	<param1_value>
<param2_name>	<param2_value>
<param3_name>	<param3_value>
<param4_name>	<param4_value>
...
```

The parameter values will be floats. The parameter files generated by CMA-ES will use a tab for the whitespace.

## Creating an initial parameter set for optimization

The optimization needs initial parameters and CMA-ES needs to know how much exploration to do initially. This information is given by the seed file. The seed file is similar to the parameter files that will be fed to your executable. However, it repeats the parameter values a second time where the second ocurrence of a parameter value is used as an initial amount of variance for CMA-ES to use when adding exploration noise to each parameter. The seed file will look like:

```
<param1_name>	<param1_value>
<param2_name>	<param2_value>
<param3_name>	<param3_value>
<param4_name>	<param4_value>
...

<param1_name>	<param1_standard_deviation>
<param2_name>	<param2_standard_deviation>
<param3_name>	<param3_standard_deviation>
<param4_name>	<param4_standard_deviation>
...
```

## Creating an optimization config file

Finally, the CMA-ES code needs to know what executable

# Optimization

## Steps to run on the UT Cluster

1. `./cma-es <absolute/path/to/result/directory> <path/to/config_file> <num_iterations> --pop_size=<population_size> --seed_file=<path/to/seed_file>`

And that's it. You should see output that shows the progress of your optimization.

## Steps to run locally

1. `./cma-es <absolute/path/to/result/directory> <path/to/config_file> <num_iterations> --pop_size=<population_size> --seed_file=<path/to/seed_file> --run_local`

And that's it. You should see output that shows the progress of your optimization.


# Post-optimization visualization

## Plotting results

1. `./plot_run.py <path/to/result/directory/results>`

This script will plot the average performance of each iteration over all parameters tested in that iteration and the performance of the best 

## Observing best

1. `cd <path/to/result/directory/results>; grep . v* | sort -g -t: -k2`

These commands will print out a list of the value of each tested parameter file in ascending order.
